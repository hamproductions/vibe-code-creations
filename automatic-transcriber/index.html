<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatic Transcriber</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Essentia.js -->
    <script src="https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia-wasm.web.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia.js-core.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-900 text-gray-200 font-sans min-h-screen">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 z-50 flex flex-col items-center justify-center bg-gray-900/95 backdrop-blur-sm">
        <!-- Spinner using Tailwind utility classes -->
        <div class="w-[50px] h-[50px] border-4 border-gray-700 border-t-blue-500 rounded-full animate-spin mb-6"></div>
        <div id="loading-text" class="text-xl text-white font-bold mb-2">Processing Audio...</div>
        <div class="text-sm text-gray-400 mb-6">This happens locally in your browser.</div>

        <div class="w-1/2 max-w-md h-2 bg-gray-800 rounded-full overflow-hidden mb-8">
            <div id="global-progress" class="h-full bg-blue-500 w-0 transition-all duration-75"></div>
        </div>

        <button onclick="cancelProcess()" class="text-gray-500 hover:text-white text-sm border border-gray-700 hover:border-gray-500 px-4 py-2 rounded transition">
            Cancel
        </button>
    </div>

    <!-- Main Interface -->
    <div class="max-w-7xl mx-auto p-4">

        <!-- Header / Controls -->
        <div class="bg-gray-800 rounded-xl p-4 shadow-xl border border-gray-700 mb-6 sticky top-4 z-40 backdrop-blur-md bg-opacity-90">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">

                <!-- Title & Upload Button -->
                <div class="flex items-center gap-4 w-full md:w-auto">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shrink-0">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="font-bold text-lg leading-tight">Smart Player</h1>
                        <div class="text-xs text-green-400 font-mono" id="system-status">Initializing Core...</div>
                    </div>

                    <!-- Header Upload Button -->
                    <label class="ml-4 cursor-pointer bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold py-2 px-4 rounded shadow transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        Upload Song
                        <input type="file" id="file-input-header" accept="audio/*" class="hidden" />
                    </label>
                </div>

                <!-- Transport -->
                <div class="flex-1 w-full px-2">
                    <audio id="audio-el" class="w-full h-10 rounded opacity-90 hover:opacity-100 transition focus:outline-none" controls></audio>
                </div>

                <!-- Alignment Controls -->
                <div class="flex items-center gap-1 bg-gray-900 rounded-lg p-1 border border-gray-700 shrink-0">
                    <button onclick="shiftGrid(-1)" class="p-2 hover:bg-gray-700 rounded text-gray-400 hover:text-white transition" title="Shift Left">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <span class="text-[10px] font-mono text-gray-500 select-none px-1">SHIFT GRID</span>
                    <button onclick="shiftGrid(1)" class="p-2 hover:bg-gray-700 rounded text-gray-400 hover:text-white transition" title="Shift Right">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Meta Data -->
            <div class="flex gap-6 mt-4 text-xs font-mono text-gray-500 border-t border-gray-700 pt-2">
                <div>BPM: <span id="meta-bpm" class="text-green-400 font-bold">--</span></div>
                <div>KEY: <span id="meta-key" class="text-blue-400 font-bold">--</span></div>
                <div>OFFSET: <span id="meta-offset" class="text-yellow-400 font-bold">0</span> beats</div>
            </div>
        </div>

        <!-- Grid Container -->
        <!-- measure-grid class is kept for custom padding-bottom -->
        <div id="grid-container" class="measure-grid flex flex-wrap gap-1.5 min-h-[400px]">
            <!-- Empty State -->
            <div id="empty-state" class="w-full flex flex-col items-center justify-center mt-20 text-gray-500">
                <div class="text-6xl mb-4 opacity-20">ðŸŽµ</div>
                <p class="text-xl font-bold text-gray-300 mb-2">No Song Loaded</p>
                <p class="text-sm mb-8">Upload an audio file (MP3/WAV) to detect chords and beats.</p>

                <label class="cursor-pointer bg-gray-800 hover:bg-gray-700 text-blue-400 hover:text-blue-300 border border-gray-600 hover:border-blue-500 text-lg font-medium py-4 px-8 rounded-xl transition shadow-lg flex items-center gap-3 group">
                    <div class="bg-blue-500/20 p-2 rounded-full group-hover:bg-blue-500/30 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                    </div>
                    Select Audio File
                    <input type="file" id="file-input-main" accept="audio/*" class="hidden" />
                </label>
            </div>
        </div>

    </div>

    <!-- App Logic -->
    <script src="app.js"></script>
</body>
</html>
